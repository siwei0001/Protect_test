{"version":3,"sources":["assets/scripts/manage/SaveManage.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Utils from \"../utils/Utils\";\n\n/**\n * 用户存档数据读取 \n */\nvar BaseSav_Data = {\n    UserName: \"游客\",                //用户名字\n    UserHeadIcon: \"\",               //用户头像地址\n    Diamond: 0,                     //钻石\n    Coins: 0,                       //金币数\n    LastTime: 0,                    //上次游戏时间\n    Level: 1,                       //关卡\n    KeyNum: 0,                      //钥匙数\n    SkinID: 1,                      //皮肤id\n    SkinList: [1],                  //皮肤列表\n    Guide: false,                   //指导标记                       \n\n}\n\n/**\n * 皮肤数\n */\nexport var CarSkinMax = 8;\n\n/**\n * 基础关卡\n */\nexport var LevelBase = 13;\n\n/**\n * 最大关卡数\n */\nexport var LevelMax = 85;\n\n/**\n * 游戏中显示指导提示时间\n */\nexport var GameGuideTime = 5;\n\nexport default class SaveManage {\n\n    private static _instance: SaveManage;\n    private _uuidKey: string = \"huaxiantingche2020061804\"; //uuid存储key\n    private _UserData: any = null;\n    private _IsLoading: boolean = false;\n\n    /**\n     * 构造函数\n     */\n    constructor() {\n    }\n\n    public static getInstance(): SaveManage {\n        // 如果 instance 是一个实例 直接返回，  如果不是 实例化后返回\n        this._instance || (this._instance = new SaveManage())\n        return this._instance\n    }\n\n    /**\n     * 存取存档\n     */\n    SvaveUserData() {\n        let uuid = JSON.parse(cc.sys.localStorage.getItem(this._uuidKey));\n        cc.sys.localStorage.setItem(uuid, JSON.stringify(this._UserData));\n    }\n\n    /**\n     * 读取存档\n     */\n    LoadUserData() {\n        let uuid = cc.sys.localStorage.getItem(this._uuidKey);\n        if (!uuid) {\n            uuid = Utils.GetUUID();\n            cc.sys.localStorage.setItem(this._uuidKey, JSON.stringify(uuid));\n        }\n        else {\n            uuid = JSON.parse(uuid);\n        }\n\n        let userdata = cc.sys.localStorage.getItem(uuid);\n\n        if (!userdata) {\n            //初始化\n            this._UserData = BaseSav_Data;\n            this._UserData.UserName = BaseSav_Data.UserName + String(uuid).slice(0, 6);\n            this.SvaveUserData();\n        }\n        else {\n            this._UserData = JSON.parse(userdata);\n            if (!this._UserData.UserName) {\n                this._UserData.UserName = BaseSav_Data.UserName + uuid.splice(0, 6);\n            }\n\n            if (!this._UserData.UserHeadIcon) {\n                this._UserData.UserHeadIcon = BaseSav_Data.UserHeadIcon;\n            }\n            if (!this._UserData.Diamond) {\n                this._UserData.Diamond = BaseSav_Data.Diamond;\n            }\n            if (!this._UserData.Coins) {\n                this._UserData.Coins = BaseSav_Data.Coins;\n            }\n            if (!this._UserData.LastTime) {\n                this._UserData.Coins = BaseSav_Data.LastTime;\n            }\n            if (!this._UserData.Level) {\n                this._UserData.Level = BaseSav_Data.Level;\n            }\n            if (!this._UserData.KeyNum) {\n                this._UserData.KeyNum = BaseSav_Data.KeyNum;\n            }\n            if (!this._UserData.SkinID) {\n                this._UserData.SkinID = BaseSav_Data.SkinID;\n            }\n            if (!this._UserData.SkinList) {\n                this._UserData.SkinList = BaseSav_Data.SkinList;\n            }\n            if (!this._UserData.Guide) {\n                this._UserData.Guide = BaseSav_Data.Guide;\n            }\n        }\n    }\n\n    GetUserUUID() {\n        let uuid = cc.sys.localStorage.getItem(this._uuidKey);\n        if (!uuid) {\n            uuid = Utils.GetUUID();\n            cc.sys.localStorage.setItem(this._uuidKey, JSON.stringify(uuid));\n        }\n        else {\n            uuid = JSON.parse(uuid);\n        }\n        return uuid;\n    }\n    /**\n     * 玩家数据初始化\n     */\n    InitUserData() {\n        Utils.CCLog('InitUserData');\n\n        //如果存档为空 则读取存档\n        if (this._UserData == null) {\n            this.LoadUserData();\n            // LastTime\n            //更具上次游戏时间更新当天数据\n            if (Utils.GetTimeDay(cc.sys.now()) > Utils.GetTimeDay(this._UserData.LastTime)) {\n                Utils.CCLog(\"初始化当天数据\", \"nowday\", Utils.GetTimeDay(cc.sys.now()), \"lasteDay\", Utils.GetTimeDay(this._UserData.LastTime));\n                //更新游戏时间\n                this._UserData.LastTime = cc.sys.now();\n                this.SetGuide(false);\n            }\n            Utils.CCLog(\"savemanage _UserData\", this._UserData);\n        }\n    }\n\n    /**\n     * 设置用户的名字\n     * @param {string} _username\n     */\n    SetUserName(_username: string) {\n        this._UserData.UserName = _username;\n        this.SvaveUserData();\n    }\n\n    /**\n     * 返回用户的名字\n     */\n    GetUserName() {\n        return this._UserData.UserName;\n    }\n\n    /**\n     * 设置用户的头像\n     * @param {string} _headIconUrl\n     */\n    SetUserHeadIcon(_headIconUrl: string) {\n        this._UserData.UserHeadIcon = _headIconUrl;\n        this.SvaveUserData();\n    }\n\n    /**\n     * 返回的头像\n     */\n    GetHeadIcon() {\n        return this._UserData.UserHeadIcon;\n    }\n\n    /**\n     * 增加金币\n     * @param {number} _num\n     */\n    AddCoins(_num: number) {\n        this._UserData.Coins += _num;\n        this.SvaveUserData();\n    }\n\n    /**\n     * 减少金币\n     * @param {number} _num\n     */\n    DelCoins(_num: number) {\n        Utils.CCLog('DelGlod is CoinsNum', _num, \"userCoins\", this._UserData.Coins);\n        if (this._UserData.Coins >= _num) {\n            this._UserData.Coins -= _num;\n            this.SvaveUserData();\n            return true;\n        }\n        else {\n            Utils.CCLog('Coins is less');\n            return false;\n        }\n    }\n\n    /**\n     * 返回金币\n     */\n    GetCoins() {\n        return this._UserData.Coins;\n    }\n\n    /**\n     * 设置游戏第一次加载\n     * @param {boolean} _isLoading \n     */\n    SetIsLoading(_isLoading: boolean) {\n        this._IsLoading = _isLoading;\n    }\n\n    /**\n     * 返回游戏第一次加载\n     */\n    GetIsLoading() {\n        return this._IsLoading;\n    }\n\n    /**\n     * 设置关卡数\n     * @param {number} _level \n     */\n    SetLevel(_level: number) {\n        this._UserData.Level = _level;\n        this.SvaveUserData();\n    }\n\n    /**\n     * 返回关卡数\n     */\n    GetLevel() {\n        return this._UserData.Level;\n    }\n\n    /**\n    * 增加钥匙数\n    * @param {number} _num\n    */\n    AddKeyNum(_num: number) {\n        this._UserData.KeyNum += _num;\n        this.SvaveUserData();\n    }\n\n    /**\n    * 减少钥匙数\n    * @param {number} _num\n    */\n    DelKeyNum(_num: number) {\n        if (this._UserData.KeyNum >= _num) {\n            this._UserData.KeyNum -= _num;\n            this.SvaveUserData();\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * 返回钥匙数\n     */\n    GetKeyNum() {\n        return this._UserData.KeyNum;\n    }\n\n    /**\n     * 设置选中的皮肤\n     * @param {any} _id \n     */\n    SetSkinID(_id: any) {\n        this._UserData.SkinID = _id;\n        this.SvaveUserData();\n    }\n\n    /**\n     * 返回选中的皮肤id\n     */\n    GetSkinID() {\n        return this._UserData.SkinID;\n    }\n\n    /**\n     * 解锁对应id的皮肤\n     */\n    UnlockSkindID(_id: any) {\n        this._UserData.SkinList.push(_id);\n        this.SvaveUserData();\n    }\n\n    /**\n     * 返回对应id的皮肤是否解锁了\n     * @param {any} _id \n     */\n    SkinIDIsUnlock(_id: any) {\n        let skinlist = this._UserData.SkinList;\n        for (let index = 0; index < skinlist.length; index++) {\n            const id = skinlist[index];\n            if (id == _id) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    /**\n     * 设置指导标记\n     */\n    SetGuide(_vaule: boolean) {\n        this._UserData.Guide = _vaule;\n        this.SvaveUserData();\n    }\n\n    /**\n     * 返回指导标记\n     */\n    GetGuide() {\n        return this._UserData.Guide;\n    }\n\n}\n"]}